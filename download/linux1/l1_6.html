<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Transitional//EN">
<HTML>
	<HEAD>
		<TITLE>Лабораторная работа 6.</TITLE>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="Authors" content="A.S. Derevjanko, N.V. Maksyuta">
		<meta name="Generator" content="KDevelop">
		<meta name="Description" content="Operating systems, pz ">
		<meta name="Keywords" content="операционные системы, unix, linux">
		<!--                                                                   -->
		<!-- (C) Owner: A.S. Derevjanko, N.v. Maksyuta  -->
		<!-- (C) НТУ "ХПИ". Каф. Вычислительной техники и программирования-->
		<script language="JavaScript">
<!--
  function SWin(str) {
  window.open(str,"window_name", 
    "width=190,height=230,toolbar=no");
    }  
<!---->
		</script>
		<script language="JavaScript">
<!--
  function LWin(str) {
  window.open(str,"window_name", 
    "toolbar=no");
    }  
<!---->
		</script>
	</HEAD>
	<body >
		<p>
			<!--
			<table cellpadding="10">
				<tr>
					<td><a href="../../index.htm">Каталог</a></td>
					<td><a href="../../spo/index.htm">Индекс раздела</a></td>
					<td></td>
				</tr>
			</table>
			-->
			<table cellpadding="10">
				<tr>
					<td><a href="l1_5.html">Назад</a></td>
					<td><a href="index.htm">Оглавление</a></td>
					<td><a href="l1_7.html">Вперед</a></td>
				</tr>
			</table>
		</p>
		<hr>
		<table width="90%">
			<tr>
				<td align="center"><img src="logo_6.gif"><samp>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</samp></td>
				<td>
					<h2 align="center">Лабораторная работа 6</h2>
					<h2 allign=center>  Основные команды файловой системы.</h2>
					<p><b>Цель работы</b>: Получение практических навыков работы с основными командами файловой системы.
				</p>
				</td>
			</tr>
		</table>
		<p><b>Начальные сведения</b> о файловой системе Unix/Linux вы можете прочитать <A href="./man/l1aa_1.html">
				здесь</A> или в описании <A href="./l1_1.html">лабораторной работы 1</A> и <A href="./l1_2.html"> лабораторной работы 2</A>
			<h3>Выполнение работы</h3>
			<h4>Теоретические сведения</h4>
<p>
<h4>1. Структура файловой системы и каталогов linux</h4>
Устройство файловой системы linux очень сильно отличается от устройства в windows. Для начала, в линуксе нет дисков C или D. Один 
физический диск (или несколько) при установке системы разбивается на каталоги и подкаталоги. Основной, корневой каталог обозначается 
символом / (слэш) Вместо файла подкачки существует отдельный раздел /swap. Каждый каталог можно форматировать в нужную файловую систему,
в зависимости от задач пользователя. Например Ext3, ReiserFS, JFS или другую.
В разных дистрибутивах линукс схема и назначение некоторых каталогов может несколько отличаться.
Можно создавать свои каталоги. Например, разместить на отдельном жестком диске каталог с фильмами. В корневом разделе он 
будет выглядеть как /films.
<p>
<i>Описание основных каталогов и подкаталогов в linux:</i>
<p>
<b>/bin</b> — В нем находятся основные файлы команд.

<br><b>/boot</b> — В этом каталоге находится загрузчик системы (Grub или Lilo) и файлы, необходимые для загрузки системы.

<br><b>/dev </b>- В каталоге dev размещаются файлы описания устройств компьютера. В linux все устройства считаются файлами. Даже порты, диски, принтеры - все файл.

<br><b>/etc </b>- Каталог, в котором находятся конфигурационные файлы системы, программ, стартовые сценарии.
<br><b>/etc/rc.d </b>- файлы команд, запускающие приложения при загрузке системы.
<br><b>/etc/passwd</b> - в файле зашифрованы все данные о пользователях.
<br><b>/etc/fstab</b> - в файле содержится информация о файловых системах, автоматически монтируемых при запуске системы

<br><b>/home </b>- Пользовательский, домашний каталог. В linux может быть множество пользователей. Каждый пользователь имеет свой каталог.(например /home/user) В нем находятся любые файлы пользователей к которым он имеет непосредственный доступ записи/удаления. Также в домашнем каталоге находятся пользовательские программы, настройки. Их имена начинаются на точку и выглядят, к примеру, вот так - .kde .fonts

<br><b>/lib</b> - Здесь находятся различные библиотеки системы, модули ядра
<br><b>/lib/firmware </b>- несвободные модули ядра с закрытой лицензией
<br><b>/lib/modules</b> - подгружаемые модули ядра. Например драйверы устройств, файловых систем.

<br><b>/mnt </b>- В этот каталог временно монтируются различные подключаемые устройства. Флешки, дискеты, диски

<br><b>/opt</b> - В каталог устанавливаются дополнительные пакеты программ.

<br><b>/proc </b>- Каталог с виртуальной файловой системой. В нем, в виде файлов содержится информация о находящихся в системе процессах.
<br><b>/proc/modules </b>- в этом файле находится информация о списке загруженных модулей ядра.
<br><b>/proc/cpuinfo </b>- подробная информация о процессоре.
<br><b>/proc/meminfo </b>- информация об оперативной памяти.
<br><b>/proc/devices </b>- драйверы устройств встроенных в ядро системы.
<br><b>/proc/uptime </b>- информация про uptime системы. Т.е. Время работы без перезагрузки.
<br><b>/proc/version</b> - версия используемого системой ядра linux.
Все эти данные можно выводить в консоли с помощью команды cat.
<br>Например cat /proc/cpuinfo

<br><b>/root</b> - Домашний каталог администратора(суперпользователя) системы. Используется администратором в случае если основной каталог home по каким-то причинам недоступен.

<br><b>/sbin </b>- Тут находятся основные программы выполняемые root.

<br><b>/tmp</b> - Каталог для временного хранения данных программами.

<br><b>/usr </b>- Основной каталог для установки программ. Кроме программ, в нем находятся файлы документации, исходные коды программ, ядра.
<br><b>/usr/local </b>- в этом каталоге находятся отдельно устанавливаемые пакеты программ.
<br><b>/usr/src </b>- исходники установленных программ и ядра.
<br><b>/usr/man </b>- файлы руководств к установленным программам.
<br><b>/usr/lib</b> - неизменяемые конфигурационные файлы и данные программ.

<br><b>/var </b>- В каталоге var находятся данные которые часто меняются в процессе работы системы. Например логи, кэши программ.
<br><b>/var/local </b>- изменяемые данные программ, установленных администратором в /usr/local.
<br><b>/var/log</b> - логи различных системных программ.
<br><b>/var/run</b> - временные файлы. Информация в них хранится до очередной перезагрузки системы.
<br><b>/var/tmp</b> - каталог для временных файлов.
<p>
<h4>2. Команды работы с архивами</h4>
<p>
Имена упакованных файлов в большинстве случаев оканчиваются на:
<ul>
<li>.tar - файл усобран утилитой tar;
</li>
<li>.gz  - файл упакован архиватором gzip;
</li>
<li>.bz2 - файл упакован архиватором bzip2 (сжимает эффективнее, чем gzip).
</li>
<li>.tar.bz2 - файл усобран утилитой tar и упакован архиватором bzip2 .
</li>
<li>.tar.gzip - файл усобран утилитой tar и упакован архиватором gzip .
</li>
<li>.zip - zip-файлы.
</li>
<li>.rar - rar-файлы.

</ul>
<p>Утилита <samp> <a href="./man/_tar.html">tar</a> </samp> является одной из самых мощных утилит, предназначенных для сохранения файлов
на магнитную ленту или в архив на диске и для восстановления отдельных файлов из архива.
<p>Родственной "tar"-утилитой является утилита  <samp>cpio</samp> (см. <samp> man cpio</samp>  или  <samp>cpio --help</samp>   или 
<samp>info cpio</samp>), которая копирует файлы в архивы и из них.
<p>Однако,  основным средством архивирования в UNIX (а, следовательно, и в Linux) является комплекс из двух программ - <samp>tar</samp> и 
<samp>gzip</samp>. 
Хотя никто не запрещает пользоваться <samp>arj</samp>, <samp>pkzip</samp>, <samp>lha</samp>, <samp>rar</samp> и т. д. - версии этих программ для Linux общедоступны. 
Просто уж исторически сложилось, что пользователи Unix/Linux чаще применяют именно <samp>tar и gzip</samp>, и именно в таком формате распространяется 
большая часть программного обеспечения для Unix. Поэтому овладеть работой с <samp>tar  и gzip</samp> - дело чести любого пользователя Linux.
<p>У пользователя, привыкшего к архиваторам типа arj, которые собирают файлы в единый архив и сразу "сжимают" их, может возникнуть 
вопрос "А зачем использовать две программы?" Все дело в том, что <samp>tar</samp> расшифровывается как <samp>Tape ARchiver</samp>, он не 
сжимает данные, а лишь объединяет их в единый файл с последовательным доступом для последующей записи на ленту. По умолчанию этот 
архивный файл создается на ленточном накопителе, точнее на устройстве /dev/rmt0. Если вы хотите создать архивный файл на диске, 
то необходимо использовать команду <samp>tar с опцией f</samp>, после которой указывается имя архивного файла (подробнее опции 
<samp><a href="./man/_tar.html">tar</a></samp>)

<p><i>Примеры</i>
<table allign=center  width="80%">
  <tr>
      <td align="left" width="40%">
      # tar -cf primer.tar /home/primer.txt
      </td>
      <td align="left">
      # Создать tar-архив с именем primer.tar содержащий /home/primer.txt;
      </td>
  </tr>
  <tr>
      <td align="left" width="40%">
      # tar -czf primer.tar.gz /home/primer.txt
      </td>
      <td align="left">
      # Cоздать tar-архив с сжатием Gzip по имени primer.tar.gz (утилита tar вызывает из под себя Gzip);
      </td>
  </tr>
  <tr>
      <td align="left" width="40%">
      # tar -cjf primer.tar.bz2 /home/primer.txt
      </td>
      <td align="left">
      # Cоздать tar-архив с сжатием Bzip2 по имени primer.tar.bz (утилита tar вызывает из под себя Bzip2);
      </td>
  </tr>
  <tr>
      <td align="left" width="40%">
      # tar -xf primer.tar
      </td>
      <td align="left">
      # Распаковать архив primer.tar в текущую папку;
      </td>
  </tr>
  <tr>
      <td align="left" width="40%">
      # tar -xzf primer.tar.gz;
      </td>
      <td align="left">
      # Распаковать tar-архив с Gzip;
      </td>
  </tr>
  <tr>
      <td align="left" width="40%">
      # tar -xjf primer.tar.bz
      </td>
      <td align="left">
      # Распаковать tar-архив с Bzip2;
      </td>
  </tr>
</table>
<p>Сжатие и упаковка файлов также может выполняться с помощью следующих утилит:
<pre>
gzip - 		Сжать файлы с помощью программы GNU Zip
gunzip - 	Разжать файлы GNU Zip
compress - 	Сжать файлы традиционным методом Unix
uncompress - 	Разжать файлы традиционным методом Unix
zcat - 		Сжать/разжать файл через стандартные потоки ввода/вывода (gzip или compress)
bzip2 - 	Сжать файлы в формате BZip
bunzip2 - 	Разжать файлы BZip
zip - 		Сжать файлы в формате Windows Zip
unzip - 	Разжать файлы Windows Zip
rar - 		Сжать файлы в формате rar
unrar - 	Разжать файлы rar
</pre>
<p>Хотя программа tar создает архивы, она, как было сказано, не сжимает архивы, а просто соединяет отдельные файлы в единый архивный файл.
 Для сжатия этого файла часто применяют к оманду <samp><a href="./man/_gzip.html">gzip</a></samp>. 
<p>Поскольку программа <samp><a href="./man/_gzip.html">gzip </a></samp>не умеет сохранять в одном архиве несколько файлов, то обычно ее применяют для сжатия архивов,
 созданных программой <samp><a href="./man/_tar.html">tar</a></samp>.
<p>В последнее время все чаще вместо программы <samp><a href="./man/_gzip.html">gzip </a></samp> используется архиватор 
<samp><a href="./man/_bzip2.html">bzip2</a></samp>, 
который обеспечивает более высокую степень сжатия и работает несколько быстрее, т.к. <samp>bzip2</samp> был написан для замены <samp>gzip</samp>. 
Несмотря на это, <samp>gzip</samp> все еще используется для совместимости со старыми системами.
<p><b>Внимание!</b> По умолчанию и <samp>gzip</samp>, и <samp>bzip2</samp> удаляют упакованные (или распакованные) файлы, если только вы не используете 
опцию -c. В <samp>bzip2</samp> вы можете избежать этого, воспользовавшись специальной опцией. В <samp>gzip</samp> эквивалентной опции нет.
<p> В Linux/Unix есть утилиты, позволяющие просмотреть упакованные файлы сразу без предварительной их распаковки.
<ul>
<li>bzcat - просмотр упакованного файла bzip2 без распаковки</li>
<li>bzless - просмотр упакованного файла bzip2 без распаковки</li>
<li>zcat - просмотр упакованного файла gzip без распаковки</li>
<li>zless - просмотр упакованного файла gzip без распаковки</li>
</ul>
<p>
<h4>3. Свойства файла</h4>
<p>Cодержимое файлов в Linux- это только
половина информации. Каждый файл и директория, помимо прочего,
имеют атрибуты, которые описывают владельца, размер, права
доступа и другую информацию. Команда <samp>Is -1 </samp> выводит некоторые из этих
атрибутов, а для просмотра остальных атрибутов используются
описанные ниже команды,с некоторыми из них вы уже ознакомались в предыдущих работах:
<p>
<ul>
<li><a href=./man/_stat.html>stat </a>- Вывести атрибуты файлов и директорий</li>
<li> <a href=./man/_touch.html>touch</a> - Изменить временные метки файлов или директорий</li>
<li><a href=./man/_chown.html>chown </a>- Изменить владельца файлов или директорий </li>
<li><a href=./man/_chgrp.html>chgrp </a>- Изменить принадлежность группедля файлов или директорий</li>
<li><a href=./man/_chattr.html>chattr </a>- Изменить расширенные атрибуты файлов или директорий</li>
<li><a href=./man/_lsattr.html>lsattr</a> - Вывести список расширенных атрибутов файлов или директорий</li>
</ul>
<p> В данной работе вам предстоит ознакомится с командами:
<ul>
<li><a href=./man/_du.html>du </a>- Показать, сколько места на диске занимают файлы и директории</li>
<li><a href=./man/_file.html>file </a>- Определить (попытаться угадать) тип файла</li>
</ul>
<p>
<h4>4. Поиск файлов</h4>
<p>
Linux-системы запросто могут содержать десятки и сотни тысяч
файлов. Как найти конкретный файл, когда он вам понадобился?
Первый способ - это упорядочить ваши файлы по директориям с
продуманной схемой, но есть несколько других способов поиска
файлов, каждый из которых нужно использовать в зависимости от
того, что вы ищете. Для этого чаще всего  используются следующие утилиты:
<p>
<ul>
<li><samp><a href=./man/_find.html>find </a></samp>- Искать файл в иерархии директорий</li>
<li><samp><a href=./man/_slocate.html>slocate </a></samp>- Создать индекс файлов и искать строку в этом индексе</li>
<li><samp><a href=./man/_which.html>which </a></samp>- Искать исполняемые файлы в ваших директориях поиска (команда)</li>
<li><samp><a href=./man/_type.html>type </a></samp>- Искать исполняемые файлы в ваших директориях поиска (встроенная функция bash)</li>
<li><samp><a href=./man/_whereis.html>whereis </a></samp> - Искать исполняемые файлы, документацию и файлы с исходным кодом</li>
</ul>
<p>
Для поиска произвольного файла можно использовать утилиту <samp> find </samp>,
которая упорно перебирает файл за файлом во всех директориях в
поисках нужного файла. Утилита <samp> slocate </samp> намного быстрее, она
осуществляет поиск в заранее созданном индексе, который вы
генерируете в случае необходимости (Fedora генерирует этот индекс
ежедневно по умолчанию).
<p>
Для поиска исполняемых файлов утилиты <samp> which </samp>и <samp>type</samp> проверяют все
директории в пути поиска вашего командного процессора. Команда
<samp>type</samp> встроена в командный процессор <samp>bash</samp> (и, следовательно,
доступна только при работе в <samp>bash</samp>); <samp>type </samp>работает быстрее <samp> which </samp> и
может искать среди псевдонимов командного процессора. В отличие
от них, команда <samp> whereis</samp> исследует заранее известный набор
директорий, а не директории вашего пути поиска.
<p><i>Например:</i>
<p> <samp>find / -type f -name myfile -print </samp>- Найти определенный файл с именем myfile, начиная с корня.
<p> <samp>find / -type d -print </samp> - Вывести имена всех директорий.
<p><samp>slocate -U directory -о /tmp/myindex</samp> - Cоздание индекса конкретной директории и всех ее поддиректорий.

<p><h4><b>5. Работа с текстом в файлах</b></h4>
<p>Одна из сильных сторон Linux - это работа с текстом: обработка
текстовых файлов (или стандартного потока ввода) различными
преобразованиями. Любая программа, которая читает данные из
стандартного потока ввода и пишет данные в стандартный поток
вывода, имеет отношение к текущему разделу, но в работах мы
рассмотрим только самые употребительные и мощные из них.
<p> Команды обработки текста используются при написании скриптов с целью автоматизации работы с файлами 
при администрировании системы.
<ul>
<li><samp><a href=./man/_cut.html>cut</a></samp>	- Выделить колонки из файла</li>
<li><samp><a href=./man/_paste.html>paste </a></samp>- Вставить колонки</li>
<li><samp><a href=./man/_tr.html>tr</a></samp> - Преобразовать символы в другие символы</li>
<li><samp><a href=./man/_sort.html>sort </a></samp>- Сортировать строки текста в соответствии с различными критериями</li>
<li><samp><a href=./man/_uniq.html>uniq</a></samp> - Найти идентичные строки в файле</li>
<li><samp><a href=./man/_wc.html>wc </a></samp>- Напечатать число переводов строк, слов и байт для каждого ФАЙЛА </li>
<li><samp><a href=./man/_iconv.html>iconv </a></samp>- Преобразует указанные файлы из одной
кодировки в другую. </li>
<li><samp><a href=./man/_diff.html>diff </a></samp> - Поиск различий между двумя файлами
<li><samp><a href=./man/_join.html>join </a></samp> -  Cоединение файлов  

</ul>

<p> <h4><b>6. Способы объединения команд </h4></b>
 Существует возможность объединять несколько команд в одной командной строке. Это можно делать несколькими способами:

<p><b>Последовательное выполнение</b>
<p>    Команды выполняются одна за другой, не зависимо от результата их исполнения. В качестве разделителя выступает символ точки 
с запятой («;»).
    В качестве примера можно рассмотреть составную команду <i><samp>du -sh; date </samp></i>, которая выводит на экран содержимое домашней директории, 
а затем текущие дату и время. 

<p><b>Условное выполнение (И)</b>
<p> Проверяется код завершения первой программы, если он равен 0, производится выполнение второй программы, и так далее.
 Таким образом, последняя команда выполнится только при успешном завершении всех предыдущих. В качестве разделителя выступают 
два амперсанда («&&»).
    В качестве примера можно рассмотреть составную команду <i><samp>test -r /tmp/txt && cp /tmp/txt </i></samp>, которая проверяет 
возможность чтения файла /tmp/txt и в случае успеха, копирует этот файл в локальную директорию.
<p><b>Условное выполнение (ИЛИ)</b>
<p>
 Проверяется код завершения первой программы, если он не равен 0, производится выполнение второй программы, и так далее. 
Последняя команда будет запущена только если ни одна из предыдущих не закончилась успешно. В качестве разделителя выступают две 
вертикальный черты («||»).
 В качестве примера можно рассмотреть составную команду <i><samp>test -d /tmp/dir || mkdir /tmp/dir</i></samp>, которая проверяет 
существование директории /tmp/dir и если её нет, создаёт её.
<p><b>Конвеер</b>
<p>Выше показано, как использовать команду sort в качестве фильтра. 
При этом предполагается, что вы откуда-то получили данные в файл, или ввели данные с клавиатуры своими собственными руками. 
А что, если данные, которые вы хотите отсортировать, являются выходными данными другой программы, например, такой как <samp>ls</samp>? 
Если вы используете при сортировке опцию <samp>-r</samp>, данные будут расположены в порядке, обратном лексикографическому. 
Если вы хотите получить перечень файлов вашего каталога в обратном порядке, один из способов сделать это будет:
<pre>
        /home/user/papers# ls
        english-list
        history-final
        masters-thesis
        notes

        /home/user/papers# ls > file-list  (перенаправление резуоьтата из stdout в файл )file-list
        /home/user/papers# sort -r file-list
        notes
        masters-thesis
        history-final
        english-list
        /home/user/papers#
</pre>
<p>Здесь мы сохранили результат работы команды <samp>ls</samp> в файле, а затем выполнили <samp>sort -r</samp> над этим файлом. 
Но это требует создания временного файла для хранения результата работы <samp>ls</samp>.
<p>
Выход из положения дает "конвейер" (англ., pipeline). Конвейер ("|")- это еще одно замечательное свойство <samp>shell</samp>, которое позволяет 
связывать последовательность команд в конвейер, где <samp>stdout </samp> первой команды посылается прямо на <samp>stdin </samp>
второй команды и так далее. В нашем примере мы хотим послать <samp>stdout</samp> команды <samp>ls</samp> на <samp>stdin</samp>
 команды <samp>sort</samp>. Символ "|" олицетворяет конвейер:
<pre>
        /home/user/papers# ls | sort -r
        notes
        masters-thesis
        history-final
        english-list
        /home/user/papers#
</pre>
<p>Эта команда намного короче и, очевидно, проще набирается. Другой полезный пример. Команда
<pre>
        /home/user/papers# ls /usr/bin
</pre>
выдает на дисплей длинный список имен файлов, большинство из которых слишком быстро промелькнет на экране, 
чтобы вы успели прочитать их. Давайте подключим к просмотру перечня имен файлов каталога <samp>/usr/bin</samp> команду <samp>more</samp>.
<pre>
        /home/user/papers# ls /usr/bin | more
</pre>
Теперь вы можете постранично листать файл в свое удовольствие.
<p>
Также можно связать в конвейер более, чем две команды. Команда <samp>head</samp> представляет из себя фильтр, который отображает 
первые строки входного потока (здесь, пришедшего по конвейеру). Если мы хотим отобразить последнее имя текущего каталога, 
упорядоченного по алфавиту, мы можем написать:
<pre>
        /home/user/papers# ls | sort -r | head -1
        notes
        /home/user/papers#
</pre>
где <samp>head -1</samp> просто выдает первую строку получаемого входного потока (в данном случае это отсортированный в обратном порядке 
перечень имен файлов текущего каталога, выданных командой <samp>ls</samp>).
<p><b>Внимание! </b>Для выполнения некоторых заданий необходимо использование способов объединения команд, и, для удобства,
 перенаправления ввода/вывода, при этом может понадобиться использование команд из предыдущих работ.
<p><a href="man/etc.html">Описание файлов /etc/passwd, /etc/shadow и /etc/groups</a>


			<p>
							<p><a href="./var/LR6_IZ.html">Индивидуальные задания</a>
							<p align=left> Синтаксис команд см. в <a href=./man/mind.html>Избранные команды и свойства Unix.</a> или в консоли с помощью <samp>man</samp>.
				<hr>
				<p>

					<table cellpadding="10">
						<tr>
							<td><a href="l1_5.html">Назад</a></td>
							<td><a href="index.htm">Оглавление</a></td>
							<td><a href="l1_7.html">Вперед</a></td>
						</tr>
					</table>

				</p>
	</body>
</HTML>
