<html>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <TITLE>ED command.</TITLE>
</head>
<body >
  
<h2>Неинтерактивный текстовый редактор SED</h2>
<h3><I>Галина О. В., Суперкомпьютерный Центр</I></h3>
<hr>
<h3>1. Назначение и Формат использования</h3>
SED - неинтерактивный текстовый редактор, предназначенный для пакетного редактирования файлов. Полезен для: 
<ul>
<li>Редактирования очень больших файлов; 
<li>Редактирования файлов любой величины, если последовательность команд редактирования является слишком длинной и сложной и, следовательно, неудобной для выполнения интерактивного редактирования. 
<li>Выполнения множества раз одной и той же функции редактирования. 
</ul>
SED копирует строку из <samp>input</samp> (стандартный или указываемый набор файлов) в PATTERN SPACE (некоторая область), и к этой строке применяет все команды, адреса которых попадают в PATTERN SPACE . Затем PATTERN SPACE копируется в <samp>output</samp>. (Фактически в PATTERN SPACE находится одна строка, за исключением команды N , см.4. Функции SED ) 
Формат: 
<pre>
SED [-n] [-e script] [-f sfile] [files] 
</pre>
<samp>script</samp> - набор команд редактирования SED , который может содержать до 200 команд или до 10000 байт. 
<samp>sfile</samp> - файл со скриптом SED . 
<samp>files</samp> - файлы, предназначенные для SED -редактирования. 
<samp>-n</samp> - указывает, что в <samp>output</samp> выводятся не все строки, но только те, к которым применялась команда <samp>p</samp>. (См. 4.Функции SED и 5.Функция контекстной замены.) 
Флаг <samp>-e</samp> может быть опущен, если он присутствует один. 
Команда SED : 
<pre>
 [address[,address]] function [arguments] 
</pre>


<h3>2. Адресация в командах SED</h3>
С помощью адресации происходит отбор строк для редактирования. 
Адрес: <ul>
<li>Десятичный номер строки; 
<li><samp>$</samp> - последняя строка <samp>input</samp>; 
<li>Регулярное выражение. 
</ul>
Если адреса не указаны, то команда применяется ко всем pattern space; 
Если присутствует один адрес, то команда применяется ко всем тем pattern space, куда попадает этот адрес; 
Если указаны два адреса, то они ограничивают область применения команды. 

<h3>3. Регулярное выражение</h3>
Для осуществления отбора строк для редактирования, в адресах команд SED допускается использование регулярных выражений, заключенных в "<samp>/ /</samp>" и определяемых следующим образом: 
<ul>
<li>Регулярное выражение указывается в разделителях: "<samp>/ /</samp>" ; 
<li>любой символ (кроме специальных: <samp>\[.^*$]</samp> является регулярным выражением себя; 
<li><samp>^</samp> в начале регулярного выражения указывает на пустой символ в начале регулярного выражения. (Т.е. на начало строки) 
<li><samp>$</samp> в конце регулярного выражения указывает на пустой символ в конце регулярного выражения. (Т.е. на конец строки); 
<li><samp>\n</samp> - вставленный <samp>newline</samp> (новая строка); 
<li><samp>.</samp> - любой символ (кроме обыкновенного <samp>newline</samp>); 
<li><samp>-</samp> стоящая за регулярным выражением означает любую последовательность вхождений этого выражения, начиная с 0; 
<li> <samp>[ ] </samp> - указывает на один из символов, приведенных внутри; 
<li> <samp>[^ ] </samp> - указывает на один из символов, кроме приведенных внутри; 
<li><samp>\</samp> - перед любым символом, кроме цифр и "<samp>(</samp>" , "<samp>)</samp>" , означает этот символ. ( Экранирование специальных символов). 
<li><samp>\(x\)</samp> -, где <samp>x</samp> - регулярное выражение, указывает на <samp>x</samp> . 
<li><samp>\d</samp> -, где <samp>d</samp> - цифра, указывает копию <samp>d</samp> -го выражения, которое заключалось в скобки "<samp>\(</samp>" и "<samp>\)</samp>" ; 
<li>конкатенация регулярных выражений является регулярным выражением. 
</ul>
Примеры: 
<samp>/olga/</samp> - указывает на строки содержащие "<samp>olga</samp>" , "<samp>abcolgadef</samp>" , <samp>...</samp>; 
<samp>/ol.*ga/</samp> - указывает на строки, содержащие "<samp>olga</samp>" , "<samp>olabcga</samp>" , <samp>...</samp>; 
<samp>/^[Oo]lga/</samp> - на строки, начинающиеся с "<samp>Olga</samp>" или "<samp>olga</samp>" ; 
<samp>/./</samp> - попадают все строки, имеющие хотя бы 1 символ (не <samp>newline</samp>); 
<samp>/\./</samp> - попадают строки, содержащие "<samp>.</samp>" ; 
<samp>/^[^ ]/ </samp> - строки, не начинающиеся с "<samp>&nbsp; </samp>"
<samp>/\(ol\).*\1/</samp> - строки, содержащие два вхождения "<samp>ol</samp>" не подряд. 

<h3>4. Функции SED</h3>
(В скобках указывается максимальное число адресов) 
(1) <samp>a \text</samp> - Добавить "<samp>text</samp>" после указанной строки (вывести), потом считать следующую. 
(2) <samp>b label</samp> - Перейти на метку, устанавливаемую, с помощью функции "<samp>:</samp>" , если <samp>label</samp> пуст, то перейти в конец скрипта. 
(2) <samp>c \text</samp> - Удалить pattern space и вывести "<samp>text</samp>" на <samp>output</samp>. 
(2) <samp>d</samp> - Удалить pattern space . 
(2) <samp>D</samp> - Удалить pattern space до вставленной <samp>newline</samp>. 
(2) <samp>g</samp> - Заместить содержимое pattern space содержимым буфера hold space. 
(2) <samp>G</samp> - Добавить к содержимому pattern space содержимое буфера hold space . 
(2) <samp>h</samp> - Заместить содержимое буфера hold space на содержимое pattern space . 
(2) <samp>H</samp> - Добавить к содержимому буфера hold space содержимое pattern space . 
(1) <samp>i \text</samp> - Вывести текст на <samp>output</samp> перед указанной строкой. 
(2) n - Вывести pattern space на output и считать следующую строку. 
(2) <samp>N</samp> - Добавить следующую строку к pattern space , разделяя строки вставленным <samp>newline</samp>. 
(2) <samp>p</samp> - Скопировать pattern space на <samp>output</samp>. 
(2) <samp>P</samp> - Скопировать pattern space до первой вставленной <samp>newline</samp> на <samp>output</samp>. 
(1) <samp>q</samp> - Переход на конец <samp>input</samp>. Вывести указанную строку, (если нет флага <samp>-n</samp>) и завершить работу SED . 
(2) <samp>r rfile</samp> - Читать содержимое <samp>rfile</samp> и вывести его на <samp>output</samp> прежде чтения следующей строки. 
(2) <samp>s</samp> - Функция контекстной замены. (См. 5.) 
(2) <samp>t label</samp> - Перейти на метку, устанавливаемую с помощью функции "<samp>:</samp>" , если для этой строки была осуществлена замена с помощью функции "<samp>s</samp>" . Флаг осуществления замены восстанавливается при чтении следующей строки или при выполнении функции "<samp>s</samp>". 
(2) <samp>w wfile</samp> - Добавить pattern space к концу файла <samp>wfile</samp>. (Максимально можно использовать до 10 открытых файлов.) 
(2) <samp>x</samp> - Поменять местами содержимое pattern space и буфера hold space . 
(2) <samp>y /str1/str2/</samp> - Заменить все вхождения символов из <samp>str1</samp> на соответствующие из <samp>str2</samp>. Длины строк должны быть равными. 
(2) <samp>! func</samp> - Применять функцию <samp>func</samp> (или группу функций в <samp>{}</samp>) к стокам НЕ попадающим в указанные адреса. 
(0) <samp>: label</samp> - Устанавливает метку для перехода по "<samp>b</samp>" и "<samp>t</samp>" командам. 
(1) <samp>=</samp> - Выводит номер строки на <samp>output</samp> как строку. 
(2) <samp>{</samp> - Выполняет функции до "<samp>}</samp>" , только когда выбрано pattern space . Группировка функций. 
(0)  <samp>&nbsp; </samp> - Пустая команда игнорируется. 
<samp>#</samp> - Комментарий. 
( "<samp>#n</samp>" в скрипте равносильно установке флага <samp>-n</samp>) 

<h3>5. Функция контекстной замены</h3>
Формат: 
(2) 
s/&lt;Регулярное выражение&gt; /&lt;Замена&gt; /&lt;флаги&gt; 
Функция <samp>s</samp> заменяет вхождение <samp>&lt;Регулярного выражения&gt; </samp> в pattern space на <samp>&lt;Замену&gt; </samp>. 
<samp>&lt;Регулярное выражение&gt; </samp> : Аналогично выше данному, но может быть заключено не в "<samp>/ /</samp>" а в любые другие символы (не "<samp>&nbsp; </samp>" (пробел) и не <samp>newline</samp>). 
<samp>&lt;Замена&gt; </samp> : Любой набор символов. Используются специальные символы: 
"<samp>&</samp>" - Заменяется на строку, указанную в регулярном выражении. 
"<samp>\d</samp>" - , где <samp>d</samp> - цифра, указывает на <samp>d</samp>-е выражение, заключенное в "<samp>\(</samp>","<samp>\)</samp>" в регулярном выражении. 
<samp>&lt;Флаги&gt; </samp> : 
<samp>g</samp> - Глобальная замена: заменить все вхождения в строке. 
<samp>p</samp> - Печатать (выводить на <samp>output</samp>) строки, в которых была осуществлена замена. 
<samp>w wfile</samp> - Выводить в файл <samp>wfile</samp> строки, в которых была осуществлена замена. 
Примеры: 
<samp>s/to/by/w changes</samp> - Заменить в тексте первое вхождение "<samp>to</samp>" в каждой строке, если таковое есть, на "<samp>by</samp>" и измененные строки сохранить в файле "<samp>changes</samp>". 
<samp>/iiii/s/[Oo]lga/ Olga V.Galina/p</samp> - Заменить в тексте, в строках, где встречается вхождение "<samp>iiii</samp>" , первое вхождение подстроки "<samp>olga</samp>" или "<samp>Olga</samp>" на "<samp> Olga V.Galina</samp>" , при этом измененные строки выводить на печать. 
<samp>s/[.,;:?]/*sign& *sign& **/g</samp> - Заменить в тексте каждое вхождение одного из знаков "<samp>.,;:?</samp>" в строку на "*<samp>sign& *</samp>" , где <samp>&</samp> будет тем знаком, который стоял прежде, например, "<samp>.</samp>" на "<samp>*sign.* </samp>" , "<samp>?</samp>" на "<samp>*sign?* </samp>" и т. д. 

<h3>6. Сравнительное решение задач с помощью SED и AWK</h3>
Система UNIX обладает несколькими утилитами, которые обрабатывают входной поток данных и позволяют также решать некоторые задачи редактирования: <samp>grep</samp>, <samp>egrep</samp>, <samp>fgrep</samp>, <samp>lex</samp> и <samp>awk</samp>. Мощная и многофункциональная утилита <samp>awk</samp> также может быть применена для простого редактирования текстов, поскольку также основана на использовании регулярных выражений. Однако, как видно из примеров, приведенных ниже, время решения задач с помощью <samp>sed</samp> значительно меньше по сравнению со временем, затрачиваемым <samp>awk</samp>. Неинтерактивный редактор <samp>sed</samp> обеспечивает выполнение в пакетном режиме большинства функций редактирования редактора <samp>ed</samp> и является оптимальным при решении несложных задач пакетного редактирования. 

<h3>Примеры: </h3>
<ol>
<li><b>Посчитать количество строк (input) </b>
<pre>
SED: $= (10.2 c.) 
AWK: END { PRINT NR } (15.0 c.) 
</pre>

<li><b>Напечатать все строки, содержащие "olga" </b>
<pre>
SED: /olga/p (11.6 c.) 
AWK: /olga/ (25.6 c.) 
</pre>

<li><b>Напечатать все строки, содержащие "olga", "mike" или "mal"</b>
<pre>
SED:     /olga/p
         /olga/d
         /mike/p
         /mike/d
         /mal/p
         /mal/d      (15.8 c.)

AWK:     /olga|mike|mal/   (29.9 c.)
</pre>

<li><b>Напечатать третье поле каждой строки</b>
<pre>
SED: /[^ ]* [ ]*[^ ]* [ ]*\([^ ]*\).*/s//\1/p (29.0 c.) 
AWK: {PRINT $3} (33.3 c.) 
</pre>

<li><b>Напечатать сначала третье а затем второе поля каждой строки</b>
<pre>
SED: /[^ ]* [ ]*\([^ ]*\) [ ]*\([^ ]*\).*/s//\2\1/p (30.5 c.) 
AWK: {PRINT $3 $2} (38.9 c.) 
</pre>

<li><b>Добавить строки, содержащие "olga", "mike" или "mal" соответственно к файлам: folga, fmike, fmal</b>
<pre>
SED:    /olga/w folga
        /mike/w fmike
        /mal/w fmal          (16.1 c.)

AWK:    /olga/ {print >  "folga"}
        /mike/ {print >  "fmike"}
        /mal/ {print >  "fmal"}   (46.4 c.)
</pre>

<p><hr>
<a href=mind.html#ed>Список команд</a>
</body>
</html>
</body>
</html>


