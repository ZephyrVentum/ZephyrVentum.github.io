<HTML>
	<head>
		<TITLE>Example 12</TITLE>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	</head>
	<body >
		<a href="l2_4.html#ex">Назад</a>
		<hr>
		<table>
			<tr>
				<td><img src="slBakzap.gif">&nbsp;&nbsp;&nbsp;&nbsp;</td>
				<td><h3>Пример выполнения лабораторной работы N12</h3>
				</td>
			</tr>
		</table>
		<p>
		В этой работе мы моделируем ту же "легенду", что и в предыдущей: стадо Слонов 
		движется вдоль цепочки луж. Отличия состоят в том, что найденные лужи Ганеша 
		назначает Слонам по списку. Можно представить, что Ганеша движется впереди 
		стада и возле каждой найденной лужи оставляет "метку", определяющую, какому 
		Слону данная лужа предназначена. Список Слонов при этом играет роль кольцевой 
		очереди, но Ганеша учитывает потребность каждого Слона и после выделения ему 
		достаточного количества воды больше не планирует его на водопой.
		<p>
			Реализация этой модели при помощи именованных каналов состоит в следующем. Для 
			выдачи каждому Слону его порций воды создается отдельный канал. Этот канал 
			является выходным для Ганеши и входным - для Слона. Имя этого канала совпадает 
			с именем Слона. Для приема докладов от Слонов об окончании водопоя создается 
			один канал с именем "<samp>Ganesha</samp>
		". К выходному концу этого канала подключен Ганеша, а к входному - все Слоны.
		<p>
			При нахождении очередной порции воды Ганеша заносит размер этой порции (число 
			типа <samp>long</samp>
		в канал того Слона, которому порция предназначена. Слон считывает из своего 
		входного канала размер порции и приступает к ее "потреблению".
		<p>
		Обеспечив всех Слонов водой Ганеша "погружается в спячку" на 30 сек. Слон, 
		"употребив" очередную порцию анализирует остаток своей потребности. Если 
		потребность не удовлетворена, Слон считывает из своего входного канала размер 
		следующей порции и т.д. Если потребность Слона удовлетворена, он записывает в 
		свой выходной канал (входной канал Ганеши) свое имя - как рапорт об окончании 
		водопоя.
		<p>
		"Пробудившись из спячки" Ганеша читает содержимое своего входного канала - до 
		окончания данных в нем. Слонов, имена которых считаны из канала Ганеша считает 
		нормально завершившимся. Остальным Слонам Ганеша посылает сигнал завершения, и 
		они гибнут.
		<p>
			Некоторую сложность при реализации данной модели может представлять 
			синхронизация работы процессов с каналами. При этом следует учитывать следующие 
			обстоятельства:
			<ul>
				<li>
				если процесс пытается открыть канал для чтения, а канал еще не открыт для 
				записи, процесс переводится в состояние ожидания;
				<li>
					если процесс пытается открыть канал для записи, а канал еще не открыт для 
					чтения, процесс переводится в состояние ожидания.</li>
			</ul>
		При наличии двух (или более) процессов и двух каналов, возможна ситуация 
		классического тупика, показанная на рисунке:
		<p align="center"><img src="p24_1.gif">
		<p><ul>
				<li>
				системный вызов открытия несуществующего (еще не созданного) канал завершается 
				с ошибкой;
				<li>
					попытка чтения из закрытого канала или записи в закрытый канал вызывает 
					исключительную ситуацию <samp>Broken pipe</samp> и аварийному завершение 
					процесса.</li>
			</ul>
		<p>
		Строго говоря, для синхронизации деятельности процессов следовало бы 
		использовать специальные средства, но чтобы избежать усложнения примера, мы 
		попытались обойтись без них и построить алгоритмы функционирования процессов 
		таким образом, чтобы предупредить или, по крайней мере,свести к минимуму 
		вероятность возникновения нежелательных эффектов. Укрупненная схема этого 
		алгоритма показана на рисунке ниже. Красными стрелками показаны моменты 
		выполнения, в которые происходит принудительная синхронизация процессов - за 
		счет возможных ожиданий при выполнении операций над каналами.
		<p align="center"><img src="p24_2.gif">
		<p>Кодовые модули, реализующие эту программную модель - <samp>ganesha4.c</samp> и <samp>
				elephant4.c</samp>
		- показаны ниже.
		<p>
		В программах используються следующие вызовы:
		<ul>
		<li><a href="./man/_unlink.html">unlink()</a>
		<li><a href="./man/_mknod.html">mknod()</a>
		<li><a href="./man/_open.html">open()</a>
		<li><a href="./man/_read.html">read()</a>
		<li><a href="./man/_write.html">write()</a>
		<li><a href="./man/_close.html">close()</a>
		</ul>
<p>Программный модуль, реализующий деятельность Ганеши (<a href="./man/Prog/lw12/ganesha4.c">ganesha4.c</a> ) и программный модуль, реализующий деятельность 
одного Слона (<a href="./man/Prog/lw12/elephant4.c">elephant4.c</a>) см. в /home/Metod/OS/2010/Lab_2010/Part_2/man/Prog/lw12.

		<p>
		Ниже приводится пример выполнения этой модели
		<p><table border align="center">
				<tr>
					<td>
						<pre>
&nbsp;&nbsp;18:21:20.559 - Начало работы
&nbsp;&nbsp;18:21:20.576 Слон Aun приступил
&nbsp;&nbsp;18:21:20.584 Слон Tandy приступил
&nbsp;&nbsp;18:21:20.594 Слон Maya приступил
&nbsp;&nbsp;18:21:20.605 Слон BakZap приступил
&nbsp;&nbsp;18:21:20.616 Слон Hao приступил
&nbsp;&nbsp;18:21:20.619 Слон Assam приступил
&nbsp;&nbsp;18:21:20.625 Слон Hathy приступил
&nbsp;&nbsp;18:21:20.634 Слон Kitty приступил
&nbsp;&nbsp;18:21:21.630 Канал для Tandy открыт - 3
&nbsp;&nbsp;18:21:21.630 Канал для Aun открыт - 4
&nbsp;&nbsp;18:21:21.631 Канал для Assam открыт - 5
&nbsp;&nbsp;18:21:21.631 Канал для Maya открыт - 6
&nbsp;&nbsp;18:21:21.631 Канал для BakZap открыт - 7
&nbsp;&nbsp;18:21:21.632 Канал для Hao открыт - 8
&nbsp;&nbsp;18:21:21.632 Канал для Hathy открыт - 9
&nbsp;&nbsp;18:21:21.633 Канал для Kitty открыт - 10
&nbsp;&nbsp;18:21:22.640 Слон Tandy получил 766
&nbsp;&nbsp;18:21:22.660 Слон Aun получил 1100
&nbsp;&nbsp;18:21:22.730 Слон Assam получил 11
&nbsp;&nbsp;18:21:22.730 Слон Assam выпил 11, остаток потребности - 2888
&nbsp;&nbsp;18:21:22.750 Слон Maya получил 1619
&nbsp;&nbsp;18:21:22.815 Слон BakZap получил 8
&nbsp;&nbsp;18:21:22.816 Слон BakZap выпил 8, остаток потребности - 2242
&nbsp;&nbsp;18:21:22.850 Слон Hao получил 1476
&nbsp;&nbsp;18:21:22.930 Слон Hathy получил 1518
&nbsp;&nbsp;18:21:22.950 Слон BakZap получил 1886
&nbsp;&nbsp;18:21:23.080 Слон Kitty получил 213
&nbsp;&nbsp;18:21:23.120 Слон Assam получил 1047
&nbsp;&nbsp;18:21:30.410 Слон Kitty выпил 213, остаток потребности - 1287
&nbsp;&nbsp;18:21:30.411 Слон Kitty получил 809
&nbsp;&nbsp;18:21:30.904 Слон BakZap выпил 1886, остаток потребности - 356
&nbsp;&nbsp;18:21:30.904 Слон BakZap получил 356
&nbsp;&nbsp;18:21:32.314 Слон BakZap выпил 356, остаток потребности - 0
&nbsp;&nbsp;18:21:33.749 Слон Assam выпил 1047, остаток потребности - 1841
&nbsp;&nbsp;18:21:33.750 Слон Assam получил 1588
&nbsp;&nbsp;18:21:33.839 Слон Maya выпил 1619, остаток потребности - 530
&nbsp;&nbsp;18:21:34.080 Слон Maya получил 233
&nbsp;&nbsp;18:21:34.830 Слон Hathy выпил 1518, остаток потребности - 1932&nbsp;&nbsp;
&nbsp;&nbsp;18:21:34.830 Слон Hathy получил 911
&nbsp;&nbsp;18:21:35.278 Слон Maya выпил 233, остаток потребности - 297
&nbsp;&nbsp;18:21:35.278 Слон Maya получил 297
&nbsp;&nbsp;18:21:36.720 Слон Maya выпил 297, остаток потребности - 0
&nbsp;&nbsp;18:21:40.201 Слон Hathy выпил 911, остаток потребности - 1021
&nbsp;&nbsp;18:21:40.201 Слон Hathy получил 986
&nbsp;&nbsp;18:21:45.242 Слон Hathy выпил 986, остаток потребности - 35
&nbsp;&nbsp;18:21:45.243 Слон Hathy получил 35
&nbsp;&nbsp;18:21:45.243 Слон Hathy выпил 35, остаток потребности - 0
&nbsp;&nbsp;18:21:46.428 Слон Hao выпил 1476, остаток потребности - 124
&nbsp;&nbsp;18:21:46.428 Слон Hao получил 124
&nbsp;&nbsp;18:21:46.504 Слон Assam выпил 1588, остаток потребности - 253
&nbsp;&nbsp;18:21:46.504 Слон Assam получил 253
&nbsp;&nbsp;18:21:47.419 Слон Hao выпил 124, остаток потребности - 0
&nbsp;&nbsp;18:21:47.933 Слон Assam выпил 253, остаток потребности - 0
&nbsp;&nbsp;18:21:48.882 Слон Kitty выпил 809, остаток потребности - 478
&nbsp;&nbsp;18:21:48.883 Слон Kitty получил 478
&nbsp;&nbsp;ВРЕМЯ ОЖИДАНИЯ ИСТЕКЛО
&nbsp;&nbsp;18:21:54.299 Слон Kitty выпил 478, остаток потребности - 0
&nbsp;&nbsp;18:21:55.280 Слон BakZap доложил о завершении
&nbsp;&nbsp;18:21:56.290 Слон Maya доложил о завершении
&nbsp;&nbsp;18:21:57.300 Слон Hao доложил о завершении
&nbsp;&nbsp;18:21:58.310 Слон Hathy доложил о завершении
&nbsp;&nbsp;18:21:59.320 Слон Assam доложил о завершении
&nbsp;&nbsp;18:22:00.273 Слон Aun выпил 1100, остаток потребности - 0
&nbsp;&nbsp;18:22:00.330 Слон Kitty доложил о завершении
&nbsp;&nbsp;18:22:01.340 Слон Aun доложил о завершении
&nbsp;&nbsp;18:22:02.350 Слон Tandy погиб
</pre>
					</td>
				</tr>
			</table>
		<p></p>
		<hr>
		<a href="l2_4.html#ex">Назад</a>
	</body>
</HTML>
