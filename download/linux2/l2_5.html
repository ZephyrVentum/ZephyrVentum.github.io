<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Transitional//EN">
<HTML>
	<HEAD>
		<TITLE>Лабораторная работа 13.</TITLE>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 		<meta name="Authors" content="Alexander S. Derevjanko, Nataliya V. Maksyuta ">
  		<meta name="Generator" content="KDevelop">
  		<meta name="Description" content="Operating systems, labs ">
   		<meta name="Keywords" content="операционные системы, unix, linux">
		<!--                                                                   -->
		<!-- (C) НТУ "ХПИ". Каф. вычислительной техники и программирования. -->
	</HEAD>


<body>
<p>
<table cellpadding=10>
<tr>
<td><a href=l2_4.html>Назад</a></td><td><a href=index.htm>Оглавление</a></td><td><a href=l2_6.html>Вперед</a></td></tr>
</table>
</p>
<hr>

<table width=90%>
<tr><td align=center><img src=logo_5.gif><samp>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>
<h2 align=center>Лабораторная работа №13</h2>
<h2 align="center">Синхронизация процессов с помощью семафоров</h2>
<p><b>Цель работы</b>: освоение семафоров как средства синхронизации работы процессов. 
</td></tr></table>
<h3>Семафоры</h3>
<p>
В теории операционных систем семафор представляет собой неотрицательную целую 
переменную, над которой возможны два вида операций: <samp>P</samp> и <samp>V</samp>. 
<ul>
<li>
<samp>P</samp>-операция над семафором представляет собой попытку уменьшения 
значения семафора на 1. Если перед выполнением <samp>P</samp>-операции значение 
семафора было больше 0, <samp>P</samp>-операция выполняется без задержек. Если 
перед выполнением <samp>P</samp>-операции значение семафора было 0, процесс, 
выполняющий <samp>P</samp>-операцию, переводится в состояние ожидания до тех 
пор, пока значение семафора не станет большим 0.
<li>
<samp>V</samp>-операция над семафором представляет собой увеличение значения 
семафора на 1. Если при этом имеются процессы, задержанные на выполнении 
<samp>P</samp>-операции на данном семафоре, один из этих процессов выходит 
из состояния ожидания и может выполнить свою <samp>P</samp>-операцию.
</ul>
<p>
Семафоры являются гибким и удобным средством для синхронизации и взаимного 
исключения процессов, учета ресурсов, скрытые семафоры также используются в 
операционных системах как основа для других средств взаимодействия процессов.

<h4>Взаимное исключение на семафоре</h4>
<p>Для реализации взаимного исключения, например, предотвращения возможности 
одновременного изменения двумя или более процессами общих данных, создается 
двоичный (с возможными значениями 0 и 1) семафор <samp>S</samp>. Начальное 
значение этого семафора - 1. Критические секции кода (секции, которые могут 
одновременно выполняться только одним процессом) обрамляются "скобками" 
<samp>P(S)</samp> (в начале секции) и <samp>V(S)</samp> (в конце секции). 
Процесс, входящий в критическую секцию, выполняет операцию <samp>P(S)</samp> 
и переводит семафор в 0. Если в критической секции уже находится другой 
процесс, то значение семафора уже 0, тогда второй процесс, желающий войти в 
критическую секцию, блокируется в своей <samp>P</samp>-операции до тех пор, 
пока процесс, находящийся в критической секции сейчас, не выйдет из нее, 
выполнив на выходе операцию <samp>V(S)</samp>. 

<h4>Синхронизация на семафоре</h4>
<p>Для обеспечения синхронизации создается двоичный семафор <samp>S</samp> с 
начальным значением 0. Значение 0 означает, что событие, еще не наступило. 
Процесс, сигнализирующий о наступлении события, выполняет операцию  
<samp>V(S)</samp>, устанавливающую семафор в 1. Процесс, ожидающий наступления 
события, выполняет операцию <samp>P(S)</samp>. Если к этому моменту событие 
уже произошло, ожидающий процесс продолжает выполняться, если же событие еще 
не произошло, процесс переводится в состояние ожидания до тех пор, пока 
сигнализирующий процесс не выполнит <samp>V(S)</samp>.
<p>В случае, если одного и того же события ожидают несколько процессов, 
процесс, успешно выполнивший операцию <samp>P(S)</samp>, должен вслед за ней 
выполнить <samp>V(S)</samp>, чтобы продублировать сигнал о событии для 
следующего ожидающего процесса.

<h4>Семафор - счетчик ресурсов</h4>
<p>Если у нас имеется <samp>N</samp>  единиц некоторого ресурса, то для 
контроля его распределения создается общий семафор <samp>S</samp> с начальным 
значением <samp>N</samp>. Выделение ресурса сопровождается операцией 
<samp>P(S)</samp>, освобождение - операцией <samp>V(S)</samp>. Значение 
семафора, таким образом, отражает число свободных единиц ресурса. Если 
значение семафора 0, то есть, свободных единиц болше не остается, то очередной 
процесс, запрашивающий единицу ресурса будет переседен в ожидание в операции 
<samp>P(S)</samp> до тех пор, пока какой-либо из использующих ресурс процессов 
не освободит единицу ресурса, выполнив при этом <samp>V(S)</samp>.

<h3>Системные вызовы Unix/Linux</h3>
В ОС Unix/Linux механизм семафоров обслуживается тремя системными вызовами: 
<samp><a href=./man/_semget.html>semget</a></samp>,  
<samp><a href=./man/_semctl.html>semctl</a></samp> и 
<samp><a href=./man/_semop.html>semop</a></samp>.  
<p>Системный вызов <samp><a href=./man/_semget.html>semget</a></samp> создает массив семафоров или возвращает идентификатор уже существующего массива семафоров. Этот идентификатор используется при дальнейших операциях с семафорами. Системные вызовы работают с массивами семафоров, это сделано только лишь для того, чтобы иметь общую идентификацию для всех семафоров одной задачи. Системные вызовы <samp><a href=./man/_semctl.html>semctl</a></samp> и 
<samp><a href=./man/_semop.html>semop</a></samp> дают возможность отдельно оперировать с каждым семафором массива.
<p>Системный вызов <samp><a href=./man/_semctl.html>semctl</a></samp> позволяет выполнять управляющие операции над массивом семафоров и отдельными его элементами: читать и устанавливать значения, уничтожать массив семафоров. 
<p>Системный вызов <samp><a href=./man/_semop.html>semop</a></samp> выполняет прикладные семафорные операции: аналоги <samp>P</samp>- и <samp>V</samp>-операций, а также проверки состояния семафора.
<p>Семафоры в Unix/Linux не имеют внешних имен. При получении идентификатора 
семафора процесс пользуется числовым ключом. Разработчики несвязанных 
процессов могут договориться об общем значении ключа, который они будут 
использовать, но у них нет гарантии в том, что это же значение ключа не будет 
использовано кем-то еще. Гарантированно уникальный массив семафоров можно 
создать с использованием ключа <samp>IPC_PRIVATE</samp>, но такой ключ не 
может быть внешним. Поэтому семафоры используются, как правило, родственными 
процессами, которые имеют возможность передавать друг другу идентификаторы 
семафоров, например, через наследуемые ресурсы или через параметры вызова 
дочерней программы.
<table wifth=90% border=3><tr><td><big><big><big><b>Внимание!</b></big></big></big><br>
В процессе отладки программы у Вас могут возникать ситуации, когда программа 
будет аварийно заканчиваться или прерываться Вами прежде, чем она уничтожит 
созданные ею семафоры. Такие семафоры не удаляются в системе автоматически и 
могут накапливаться в течение многих дней. Накопление таких "забытых" семафоров
может привести к тому, что будет исчерпан системный лимит на количество 
семафоров, и очередной вызов <a href=./man/_semget.html>semget</a> закончится с 
ошибкой. Для того, чтобы этого не происходило, регулярно выполняйте процедуру 
очистки IPC: <samp>/home/metod/<a href=rmipc.html>rmipc</a></samp>. Выполняйте 
эту процедуру также перед каждым выходом из сеанса.
<p>Список созданных Вами семафоров Вы можете увидеть, выполнив команду: 
<samp>ipcs -s</samp>.
</td></tr></table>

<h3 > System V IPC: базовые понятия</h3>
<p>Вместе с ОС System V корпорация AT&amp;T предложила три новых типа IPC средств: очереди сообщений, семафоры и разделяемая память. В BSD-системах в качестве базовой формы IPC используетютя чаще всего сокеты, чем элементы System V. Linux имеет возможность использовать оба вида IPC (BSD и System V), хотя мы не будем обсуждать сокеты в рамках курса.
<p>
<b>IPC идентификаторы</b>
<p>
Каждый объект IPC имеет уникальный IPC идентификатор. Когда мы говорим "объект IPC", мы подразумеваем очередь единичных сообщений, множество семафоров или разделяемый сегмент памяти. Этот идентификатор требуется ядру для однозначного определения объекта IPC. Например, чтобы сослаться на определенный разделяемый сегмент, единственное, что вам потребуется, это уникальное значение ID, которое привязано к этому сегменту.
<p>
Идентификатор IPC уникален только для своего типа объектов. То есть, скажем, возможна только одна очередь сообщений с идентификатором "12345", так же как номер "12345" может иметь какое-нибудь одно множество семафоров или (и) какой-то разделяемый сегмент.
<p>
<b>IPC ключи</b>
<p>
Чтобы получить уникальный ID нужен ключ. Ключ должен быть взаимно согласован процессом-клиентом и процессом-сервером. Для приложения это согласование должно быть первым шагом в построении среды.
<p>
Чтобы позвонить кому-либо по телефону, вы должны знать его номер. Кроме того, телефонная компания должна знать как провести ваш вызов к адресату. И только когда этот адресат ответит, связь состоится.
<p>
В случае System V IPC "телефон" соединяет объекты IPC одного типа. Под "телефонной компанией", или методом маршрутизации, следует понимать ключ IPC.
<p>
Для генерации ключа  используются функция <a href=./man/_ftok.html>ftok </a>и на стороне клиента, и на стороне сервера.
<p>
Таким образом, значение ключа, когда оно получено, используется в
последующих системных вызовах IPC для создания или получения доступа к
объектам IPC.

<h3 >Постановка задачи</h3>
<p>I. Проанализировать результат работы программы-примера.
<p>II.Ознакомиться с <a href=l2_6.html>лабораторной работой №14.</a>
<p>III. Разработать комплекс программ, с помощью которых организован обмен данными между родителем и потомками в соответствии с индивидуальным заданием с помощью общего сегмента разделяемой памяти с учетом следующих требований:
<ul>
<li>Организовать синхронизированную работу процессов с помощью семафоров.
<li>Ход работы процессов отобразить на экране.
<li>Вариант индивидуального задания выбрать в соответствии с номером по списку в журнале группы.
</ul>
<p><a href="./var/L5_6_IZ.html">Индивидуальные задания</a>
<h3>Отчет по лабораторной работе</h3>
		<p>Отчет по лабораторной работе оформить на украинском языке в соответсвии со следующими пунктами:
			<ul>
				<li>
				Номер работы
				<li>
				Тема работы
				<li>
				Цель работы
				<li>
				Постановка задачи и индивидуальное задание
				<li>
				Тексты программ
				<li>
				Текстовое или графическое описание алгоритмов функционирования программ
				<li>
				Протокол работы программ
				<li>
				Выводы
			</ul>
<p>Пример выполнения основной части работы №13 приведен <a href=ex2_5.html>здесь</a>. 
			<p><hr>
			 <h3 align=center>Справочный материал</h3>
			  <p align=center><a href=./man/mind.html>Избранные системные вызовы Linux/Unix.</a> Краткое описание.
			  <p align=center>Cправочник библиотечных функция языка С: <a href="./man/tcclib1.txt">часть 1</a>, 
			  <a href="./man/tcclib2.txt">часть 2</a> (кодировка кириллица ibm866).
	  
					<hr>
<table cellpadding=10>
<tr><td><a href=l2_4.html>Назад</a></td>
<td><a href=index.htm>Оглавление</a></td><td><a href=l2_6.html>Вперед</a></td></tr>

</body>
</html>
