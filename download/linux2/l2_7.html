<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Transitional//EN">
<HTML>
	<HEAD>
		<TITLE>Лабораторная работа 15.</TITLE>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 		<meta name="Authors" content="Alexander S. Derevjanko, Nataliya V. Maksyuta ">
  		<meta name="Generator" content="KDevelop">
  		<meta name="Description" content="Operating systems, labs ">
   		<meta name="Keywords" content="операционные системы, unix, linux">
		<!--                                                                   -->
		<!-- (C) НТУ "ХПИ". Каф. вычислительной техники и программирования. -->
	</HEAD>

<body>
<p>
<table cellpadding=10>
<tr>
<td><a href=l2_6.html>Назад</a></td><td><a href=index.htm>Оглавление</a></td><td><a href=l2_8.html>Вперед</a></td></tr>
</table>
</p>
<hr>

<table width=90%>
<tr><td align=center><img src=logo_7.gif><samp>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>
<h2 align=center>Лабораторная работа №15</h2>
<h2 align="center">Обмен данными между процессами с помощью очередей сообщений.</h2>

<p><b>Цель работы</b>: освоение очередей сообщений как способа коммуникаций между процессами.
</td></tr></table>
<h3>Очереди сообщений</h3>
<p>
Механизм очередей дает процессам возможность посылать другим процессам потоки сформатированных данных. Процесс имеет возможность послать сообщение в определенную очередь и принять сообщение из очереди. Передача данных в очереди происходит всегда сообщениями, причем каждое сообщение имеет заголовок и тело. Заголовок всегда имеет фиксированный для данной системы формат. В него обязательно входит длина сообщения, а другая информация зависит от спецификаций конкретной системы: это может быть приоритет сообщения, тип сообщения, идентификатор процесса, пославшего сообщение, и т.п. Тело сообщения интерпретируется по правилам, устанавливаемым самими процессами: отправителем и получателем. Заголовок и тело представляют собой существенно разные структуры данных и располагаются в разных местах в памяти. Собственно очередь ОС составляет из заголовков сообщений. В элементы очереди включаются указатели на тела сообщений, располагающиеся в памяти системы. 

<h3>Системные вызовы Unix/Linux</h3>
В ОС Unix/Linux механизм очередей сообщений обеспечивается четырьмя системными вызовами: 
<samp><a href=./man/_msgget.html>msgget</a></samp>,  
<samp><a href=./man/_msgctl.html>msgctl</a></samp>,
<samp><a href=./man/_msgsnd.html>msgsnd</a></samp>, 
<samp><a href=./man/_msgrcv.html>msgrcv</a></samp>.  
<p>Системный вызов <samp><a href=./man/_msgget.html>msgget</a></samp> создает новую очередь или возвращает идентификатор уже существующей очереди. Как и другие средства взаимодействия между процессами, очереди в Unix/Linux (как и семафоры) не имеют внешних имен. При получении идентификатора очереди процесс пользуется числовым ключом. Гарантированно уникальную очередь можно создать с использованием ключа <samp>IPC_PRIVATE</samp>. При работе с очередью один из процессов создает очередь и получает ее идентификатор. Этот идентификатор затем передается используется процессом-создателем другим (возможно, дочерним) процессам и используется процессами для выполнения операций с очередью. Сформировать ключ также можно с помощью <a href=./man/_ftok.html><samp>ftok</samp></a>.
<p>Системный вызов <samp><a href=./man/_msgctl.html>msgctl</a></samp> позволяет выполнять управляющие операции над очередью: получать информацию о ее состоянии, изменять права доступа к ней, уничтожать очередь.
<p>Системные вызовы <samp><a href=./man/_msgsnd.html>msgsnd</a></samp> и <samp><a href=./man/_msgrcv.html>msgrcv</a></samp> выполняют посылку и прием сообщения соответственно. При посылке и приеме сообщений процессы оперируют числовым типом сообщения и текстом сообщения. Тип сообщения может выполнять роль приоритета: процесс может выбирать из очереди сообщения заданного типа или сообщения, имеющие наименьшее число типа. Если выборка по типу не применяется, сообщения выбираются по принципу FIFO.
<table wifth=90% border=3><tr><td><big><big><big><b>Внимание!</b></big></big></big><br>
В процессе отладки программы у Вас могут возникать ситуации, когда программа 
будет аварийно заканчиваться или прерываться Вами прежде, чем она уничтожит 
созданные ею очереди. Такие очереди не удаляются в системе автоматически и 
могут накапливаться в течение многих дней. Накопление таких "забытых" очередей 
может привести к тому, что будет исчерпан системный лимит на количество 
очередей, и очередной вызов <a href=./man/_msgget.html>msgget</a> закончится с 
ошибкой. Для того, чтобы этого не происходило, регулярно выполняйте процедуру 
очистки IPC: <samp>/home/metod/<a href=rmipc.html>rmipc</a></samp>. Выполняйте 
эту процедуру также перед каждым выходом из сеанса.
<p>Список созданных Вами очередей Вы можете увидеть, выполнив команду: 
<samp>ipcs -q</samp>.
</td></tr></table>

<h3>Постановка задачи</h3>
<p>Разработать комплекс программ, с помощью которых организован протокол обмена сообщениями между родителем и потомками в соответствии с индивидуальным заданием с помощью очереди сообщений с учетом следующих требований:
<ul>
<li>Исходные данные вводить с клавиатуры.
<li>Ход работы процессов отобразить на экране.
<li> Вариант индивидуального задания выбрать в соответствии с номером по списку в журнале группы.
</ul>
<p><a href="./var/L7_IZ.html">Индивидуальные задания</a>
<h3>Отчет по лабораторной работе</h3>
		<p>Отчет по лабораторной работе оформить на украинском языке в соответсвии со следующими пунктами:
			<ul>
				<li>
				Номер работы
				<li>
				Тема работы
				<li>
				Цель работы
				<li>
				Постановка задачи и индивидуальное задание
				<li>
				Тексты программ
				<li>
				Текстовое или графическое описание алгоритмов функционирования программ
				<li>
				Протокол работы программ
				<li>
				Выводы
			</ul>

<p>Пример выполнения основной части работы №15 приведен <a href=ex2_7.html>здесь</a>. 
			<p><hr>
			 <h3 align=center>Справочный материал</h3>
			  <p align=center><a href=./man/mind.html>Избранные системные вызовы Linux/Unix.</a> Краткое описание.
			  <p align=center>Cправочник библиотечных функция языка С: <a href="./man/tcclib1.txt">часть 1</a>, 
			  <a href="./man/tcclib2.txt">часть 2</a> (кодировка кириллица ibm866).
	  
			<hr>
		<p>
<table cellpadding=10>
<tr><td><a href=l2_6.html>Назад</a></td>
<td><a href=index.htm>Оглавление</a></td><td><a href=l2_8.html>Вперед</a></td></tr>
</body>
</html>
